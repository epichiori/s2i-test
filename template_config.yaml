kind: Template
metadata:
  name: test
  annotations:
    openshift.io/display-name: Test s2i application
    description: |-
      Test application to run from s2i generated template.

      Sample Repository: https://github.com/epichiori/s2i-test
    openshift.io/long-description: This template rapresent a test to deploy s2i applications for developers
    iconClass: icon-openshift
    tags: wfp,test,s2i
    openshift.io/provider-display-name: World Food Programme
    openshift.io/documentation-url: https://github.com/epichiori/s2i-test
  message: Your admin credentials are ${ADMIN_USERNAME}:${ADMIN_PASSWORD} 

objects:

- apiVersion: v1
  kind: ImageStream
  metadata:
    generation: 1
    labels:
      app: test
    name: test
  spec:
    lookupPolicy:
      local: false

- apiVersion: v1
  kind: BuildConfig
  metadata:
    labels:
      app: test
    name: test
  spec:
    failedBuildsHistoryLimit: 5
    output:
      to:
        kind: ImageStreamTag
        name: test:latest
    runPolicy: Serial
## GIT source
    source:
      git:
        uri: "${{GIT_SOURCE}}"
      type: Git
## s2i build strategy 
    strategy:
      sourceStrategy:
        env:
          - name: BUILD_LOGLEVEL
            value: '5'
        from:
          kind: ImageStreamTag
          namespace: openshift
          name: 'test:latest'
        forcePull: true
      incremental: true
    successfulBuildsHistoryLimit: 5
    triggers:
    - type: ConfigChange
    - imageChange: {}
      type: ImageChange
  status:
    lastVersion: 0

- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    generation: 1
    labels:
      app: test
    name: test
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      app: test
      deploymentconfig: test
    strategy:
      activeDeadlineSeconds: 21600
      resources: {}
      rollingParams:
        intervalSeconds: 1
        maxSurge: 25%
        maxUnavailable: 25%
        timeoutSeconds: 600
        updatePeriodSeconds: 1
      type: Rolling
    template:
      metadata:
        labels:
          app: test
          deploymentconfig: test
      spec:
        containers:
        - imagePullPolicy: Always
          name: test
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        schedulerName: default-scheduler
        securityContext: {}
        terminationGracePeriodSeconds: 30
    test: false
    triggers:
    - type: ConfigChange
    - imageChangeParams:
        automatic: true
        containerNames:
        - test
        from:
          kind: ImageStreamTag
          name: test:latest
      type: ImageChange

- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app: test
    name: test
  spec:
    ports:
    - name: 8080-tcp
      port: 8080
      protocol: TCP
      targetPort: 8080
    selector:
      app: test
      deploymentconfig: test
    sessionAffinity: None
    type: ClusterIP
  status:
    loadBalancer: {}

- apiVersion: v1
  kind: Route
  metadata:
    creationTimestamp: null
    labels:
      app: test
    name: test
  spec:
    host: test.127.0.0.1.nip.io
#    host: www.test.com
    path: /test/test-app/
    port:
      targetPort: 8080-tcp
    tls:
      insecureEdgeTerminationPolicy: Redirect
      termination: edge
    to:
      kind: Service
      name: test
      weight: 100
    wildcardPolicy: None

parameters:
  - name: GIT_SOURCE
    description: 'The Git repository where resides custom source code to build'
    value: https://github.com/epichiori/test-src.git

